var dateStart=(new Date).getTime();$(document).ready(function(){function a(a,b){o[a]=b,Cookies.set("playerState",JSON.stringify(o),{expires:180,path:"/"})}function b(a){d("POST",{action:"getStation",id:a},function(a){var b=JSON.parse(a),d=b[0],e={id:d.station_id,title:d.station_title,url:d.station_url};c(e)})}function c(a){return a}function d(a,b,c){$.ajax({type:a,data:b,url:"actions.php",complete:function(){},statusCode:{200:function(a){},403:function(a){var b=JSON.parse(a.responseText);$("body").prepend(b.message)}},error:function(a,b,c,d){console.log("error")},success:c})}function e(a){$("#player .info").html(a.data("stationTitle"))}function f(){var a=("0"+parseInt(n.currentTime%60)).slice(-2),b=("0"+parseInt(n.currentTime/60%60)).slice(-2);$("#player .time .hours").html(),$("#player .time .minutes").html(b),$("#player .time .seconds").html(a)}function g(a,b){d("POST",{action:"getStation",id:a},function(a){for(var c=JSON.parse(a),d=$(".playlistContainer .playlist.active"),e="",f=0;f<c.length;f++){var g=c[f];e+='<div class="track" data-station-id="'+g.station_id+'" data-station-title="'+g.station_title+'" data-station-url="'+g.station_url+'"><div class="delete"><i class="fa fa-minus"></i></div><div class="title">'+g.station_title+'</div><div class="url">'+g.station_url+"</div></div>";for(var f=0;f<o.playlists.length;f++)o.playlists[f].name==b&&(o.playlists[f].tracks.push(+g.station_id),o.currentPlaylist=f)}Cookies.set("playerState",JSON.stringify(o),{expires:180,path:"/"}),d.html(d.html()+e),d.find(".track:first").addClass("selected")})}function h(a){clearInterval(k),a.parent().children(".track:not(.selected)").removeClass("visualisation").css({backgroundImage:"none"}),a.addClass("visualisation");var b=Math.floor(360*Math.random()),c=180;k=setInterval(function(){a.css({backgroundImage:"linear-gradient(to right, hsl("+ ++b%360+", 60%, 50%) 0%, hsl("+ ++c%360+", 60%, 50%) 100%)"})},50)}function i(a){clearInterval(k),a.removeClass("visualisation"),a.css({backgroundImage:"linear-gradient(to right, hsl(0, 0%, 33%) 0%, hsl(0, 0%, 47%) 100%)"})}function j(a,b){this.name=a,this.active=b,this.tracks=[],this.currentTrack={},console.log(this)}var k;b(12);j.prototype.addTrack=function(a){console.log(this),d("POST",{action:"getStation",id:a},function(a){for(var b=JSON.parse(a),c=$(".playlistContainer .playlist"),d="",e=0;e<b.length;e++){var f=b[e];d+='<div class="track" data-station-id="'+f.station_id+'" data-station-title="'+f.station_title+'" data-station-url="'+f.station_url+'"><div class="delete"><i class="fa fa-minus"></i></div><div class="title">'+f.station_title+'</div><div class="url">'+f.station_url+"</div></div>",console.log(m),m.tracks.push(+f.id)}o.playlists[m.name]=m,console.log(o),Cookies.set("playerState",JSON.stringify(o),{expires:180,path:"/"}),c.html(c.html()+d),c.find(".track:first").addClass("selected"),console.log(JSON.parse(Cookies.get("playerState")))})},j.prototype.deleteTrack=function(a){};var l=$("body");l.attr("data-useragent",navigator.userAgent);var m,n=new Audio,o={playlists:[],currentPlaylist:0,volume:n.volume,paused:n.paused};if(void 0==Cookies.get("playerState"))console.log("cookie undefined"),o.playlists[0]=new j("Default",!0),Cookies.set("playerState",JSON.stringify(o),{expires:180,path:"/"});else{o=JSON.parse(Cookies.get("playerState")),n.volume=o.volume,n.src=o.playlists[o.currentPlaylist].currentTrack.url,n.paused=o.paused;var p=o.playlists[0].tracks;if(d("POST",{action:"getTargetStations",id:p},function(a){for(var b=JSON.parse(a),c=$(".playlistContainer .playlist"),d="",e=0;e<b.length;e++){var f=b[e];d+='<div class="track" data-station-id="'+f.station_id+'" data-station-title="'+f.station_title+'" data-station-url="'+f.station_url+'"><div class="delete"><i class="fa fa-minus"></i></div><div class="title">'+f.station_title+'</div><div class="url">'+f.station_url+"</div></div>"}c.html(c.html()+d),c.find(".track:first").addClass("selected")}),!o.paused){n.play(),$("#player .play").addClass("visualisation");var q=Math.floor(360*Math.random());k=setInterval(function(){$("#player .play").css({boxShadow:"0px 0px 5px 0.4px hsl("+ ++q%360+", 100%, 50%)",borderColor:"hsl("+ ++q%360+", 100%, 50%)"})},50)}}$("#player .play").click(function(a){if($(".playlist").children(".selected").length>0){n.src=$(".playlistContainer .selected").data("stationUrl"),o.playlists[0].currentTrack={id:$(".playlistContainer .selected").data("stationId"),url:n.src,title:$(".playlistContainer .selected").data("stationTitle")},n.play(),o.paused=n.paused;var b=$(".playlistContainer .active [data-station-id="+o.playlists[0].currentTrack.id+"]");console.log(b),h(b),Cookies.set("playerState",JSON.stringify(o),{expires:180,path:"/"}),e($(".playlist .selected")),f(),setInterval(function(){f()},1e3)}}),$("#player .stop").click(function(a){o=JSON.parse(Cookies.get("playerState")),n.pause(),o.paused=n.paused;var b=$(".playlistContainer .active [data-station-id="+o.playlists[0].currentTrack.id+"]");i(b),Cookies.set("playerState",JSON.stringify(o),{expires:180,path:"/"}),n.currentTime=0,$("#player .info").html("")}),$(".playlistContainer").on("click",".delete",function(a){var b=$(this).parents(".playlist.active").data("name"),c=$(this).parent().data("stationId"),d=console.log(b,c);$(this).parent().remove();for(var e=0;e<o.playlists.length;e++){var d=o.playlists[e];d.name==b&&d.tracks.splice(d.tracks.indexOf(c),1)}console.log(o),Cookies.set("playerState",JSON.stringify(o),{expires:180,path:"/"})}),$(".playlistContainer").on("mousedown",".track",function(a){$(this).parent().find(".selected").removeClass("selected").css({backgroundImage:"none"}),$(this).addClass("selected").css({backgroundImage:"linear-gradient(to right, hsl(0, 0%, 33%) 0%, hsl(0, 0%, 47%) 100%)"})}),$(".playlistContainer").on("dblclick",".track",function(a){var b=$(this).data("stationUrl");n.src=b,n.play(),o.playlists[0].currentTrack={id:$(".playlistContainer .selected").data("stationId"),url:n.src,title:$(".playlistContainer .selected").data("stationTitle")};var c=$(".playlistContainer .active [data-station-id="+o.playlists[0].currentTrack.id+"]");h(c),o.paused=n.paused,Cookies.set("playerState",JSON.stringify(o),{expires:180,path:"/"}),e($(this)),f(),setInterval(function(){f()},1e3)}),$("#player .volume input").val(100*n.volume),$("#player .volume input").on("input",function(b){n.volume=parseFloat($(this).val()/100),$("#player .volume .val").html($(this).val()),a("volume",n.volume)}),$("#player .find input").on("keyup",function(a){var b=$(this).val();b.length>2&&d("POST",{action:"find",target:b},function(a){var b=JSON.parse(a),c=$(".searchContainer .result");c.html("");for(var d='<div class="total"><span>'+b.length+"</span> stations is found</div>",e=0;e<b.length;e++){var f=b[e];d+='<div class="station" data-station-id="'+f.station_id+'"><div class="add"><i class="fa fa-plus"></i></div><div class="title">'+f.station_title+'</div><div class="url">'+f.station_url+"</div></div>"}c.html(d),$(".searchContainer").css({display:"inline-block"})})}),$(".searchContainer .close").on("click",function(a){$(this).parent().slideUp(500)}),$(".searchContainer").on("scroll",function(a){setTimeout(function(){$(".searchContainer").find(".close").animate({top:$(".searchContainer").scrollTop()+10+"px"},100)},50)}),$(".searchContainer").on("click",".add",function(a){g($(this).parent().data("stationId"),"Default")}),$(".searchContainer").on("dblclick",".station",function(a){g($(this).data("stationId"),"Default")}),$(".sortable").sortable({scroll:!0})}),$(window).load(function(){(new Date).getTime()});