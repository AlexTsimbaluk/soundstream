var dateStart=(new Date).getTime();$(document).ready(function(){function a(a,b){m[a]=b,Cookies.set("playerState",JSON.stringify(m),{expires:180,path:"/"})}function b(a){d("POST",{action:"getStation",id:a},function(a){var b=JSON.parse(a),d=b[0],e={id:d.station_id,title:d.station_title,url:d.station_url};c(e)})}function c(a){return a}function d(a,b,c){$.ajax({type:a,data:b,url:"actions.php",complete:function(){},statusCode:{200:function(a){},403:function(a){var b=JSON.parse(a.responseText);$("body").prepend(b.message)}},error:function(a,b,c,d){console.log("error")},success:c})}function e(a){$("#player .info").html(a.data("stationTitle"))}function f(){var a=("0"+parseInt(l.currentTime%60)).slice(-2),b=("0"+parseInt(l.currentTime/60%60)).slice(-2);$("#player .time .hours").html(),$("#player .time .minutes").html(b),$("#player .time .seconds").html(a)}function g(a,b){d("POST",{action:"getStation",id:a},function(a){for(var c=JSON.parse(a),d=$(".playlistContainer .playlist.active"),e="",f=0;f<c.length;f++){var g=c[f];e+='<div class="track" data-station-id="'+g.station_id+'" data-station-title="'+g.station_title+'" data-station-url="'+g.station_url+'"><div class="delete"><i class="fa fa-minus"></i></div><div class="title">'+g.station_title+'</div><div class="url">'+g.station_url+"</div></div>";for(var f=0;f<m.playlists.length;f++)m.playlists[f].name==b&&(m.playlists[f].tracks.push(+g.station_id),m.playlists[f].currentTrack={id:g.station_id,url:g.station_url,title:g.station_title},m.currentPlaylist=f)}Cookies.set("playerState",JSON.stringify(m),{expires:180,path:"/"}),d.html(d.html()+e),d.find(".track:first").addClass("selected")})}function h(a,b){this.name=a,this.active=b,this.tracks=[],this.currentTrack={}}function i(a){console.log(a),clearInterval(o),a.parent().children(".track:not(.selected)").removeClass("visualisation"),a.addClass("visualisation"),$("#player .play").addClass("visualisation");var b=Math.floor(360*Math.random()),c=b+180,d=Math.floor(360*Math.random());o=setInterval(function(){a.css({backgroundImage:"linear-gradient(to right, hsl("+ ++b%360+", 60%, 50%) 0%, hsl("+ ++c%360+", 60%, 50%) 100%)"}),$("#player .play").css({boxShadow:"0px 0px 5px 0.4px hsl("+ ++d%360+", 100%, 50%)",borderColor:"hsl("+ ++d%360+", 100%, 50%)"})},50)}function j(a){clearInterval(o),a.removeClass("visualisation"),a.css({backgroundImage:"linear-gradient(to right, hsl(0, 0%, 33%) 0%, hsl(0, 0%, 47%) 100%)"}),$("#player .play").css({boxShadow:"none",borderColor:"#0ff"})}var k=(b(12),$("body"));k.attr("data-useragent",navigator.userAgent);var l=new Audio,m={playlists:[],currentPlaylist:0,volume:l.volume,paused:l.paused};if(void 0==Cookies.get("playerState"))console.log("cookie undefined"),m.playlists[0]=new h("Default",!0),Cookies.set("playerState",JSON.stringify(m),{expires:180,path:"/"}),m=JSON.parse(Cookies.get("playerState"));else{m=JSON.parse(Cookies.get("playerState")),l.volume=m.volume,l.src=m.playlists[m.currentPlaylist].currentTrack.url,l.paused=m.paused,console.log($(".playlistContainer .playlist").find(".track"));$(".playlistContainer .active [data-station-id="+m.playlists[0].currentTrack.id+"]");console.log($(".playlistContainer .active [data-station-id="+m.playlists[0].currentTrack.id+"]"));var n=m.playlists[0].tracks;d("POST",{action:"getTargetStations",id:n},function(a){for(var b=JSON.parse(a),c=$(".playlistContainer .playlist"),d="",e=0;e<b.length;e++){var f=b[e];d+='<div class="track" data-station-id="'+f.station_id+'" data-station-title="'+f.station_title+'" data-station-url="'+f.station_url+'"><div class="delete"><i class="fa fa-minus"></i></div><div class="title">'+f.station_title+'</div><div class="url">'+f.station_url+"</div></div>"}c.html(c.html()+d),c.find(".track:first").addClass("selected")}),m.paused||(l.play(),$("#player .play").addClass("visualisation"),console.log($(".playlistContainer .active [data-station-id="+m.playlists[0].currentTrack.id+"]")),i($(".playlistContainer .active [data-station-id="+m.playlists[0].currentTrack.id+"]")))}var o;$("#player .play").on("mouseover",function(a){$(this).css({boxShadow:"0px 0px 5px 0.4px #0ff"})}),$("#player .play").on("mouseout",function(a){$(this).css({boxShadow:"none"})}),$("#player .play").click(function(a){if($(".playlist").children(".selected").length>0){var b=($(".playlistContainer .active .selected"),$(".playlistContainer .active [data-station-id="+m.playlists[0].currentTrack.id+"]"));console.log(b),l.src=$(".playlistContainer .selected").data("stationUrl"),m.playlists[0].currentTrack={id:$(".playlistContainer .selected").data("stationId"),url:l.src,title:$(".playlistContainer .selected").data("stationTitle")},l.play(),m.paused=l.paused,Cookies.set("playerState",JSON.stringify(m),{expires:180,path:"/"}),i($(".active [data-station-id="+m.playlists[0].currentTrack.id+"]")),e($(".playlist .selected")),f(),setInterval(function(){f()},1e3)}}),$("#player .stop").click(function(a){m=JSON.parse(Cookies.get("playerState")),l.pause(),m.paused=l.paused;var b=$(".playlistContainer .active [data-station-id="+m.playlists[0].currentTrack.id+"]");j(b),Cookies.set("playerState",JSON.stringify(m),{expires:180,path:"/"}),l.currentTime=0,$("#player .info").html("")}),$(".playlistContainer").on("click",".delete",function(a){var b=$(this).parents(".playlist.active").data("name"),c=$(this).parent().data("stationId"),d=console.log(b,c);$(this).parent().remove();for(var e=0;e<m.playlists.length;e++){var d=m.playlists[e];d.name==b&&d.tracks.splice(d.tracks.indexOf(c),1)}console.log(m),Cookies.set("playerState",JSON.stringify(m),{expires:180,path:"/"})}),$(".playlistContainer").on("mousedown",".track",function(a){$(this).parent().find(".selected").removeClass("selected"),$(this).addClass("selected")}),$(".playlistContainer").on("dblclick",".track",function(a){var b=$(this).data("stationUrl");l.src=b,l.play(),m.playlists[0].currentTrack={id:$(".playlistContainer .selected").data("stationId"),url:l.src,title:$(".playlistContainer .selected").data("stationTitle")};var c=$(".playlistContainer .active [data-station-id="+m.playlists[0].currentTrack.id+"]");i(c),m.paused=l.paused,Cookies.set("playerState",JSON.stringify(m),{expires:180,path:"/"}),e($(this)),f(),setInterval(function(){f()},1e3)}),$("#player .volume input").val(100*l.volume),$("#player .volume input").on("input",function(b){l.volume=parseFloat($(this).val()/100),$("#player .volume .val").html($(this).val()),a("volume",l.volume)}),$("#player .find input").on("keyup",function(a){var b=$(this).val();b.length>2&&d("POST",{action:"find",target:b},function(a){var b=JSON.parse(a),c=$(".searchContainer .result");c.html("");for(var d='<div class="total"><span>'+b.length+"</span> stations is found</div>",e=0;e<b.length;e++){var f=b[e];d+='<div class="station" data-station-id="'+f.station_id+'"><div class="add"><i class="fa fa-plus"></i></div><div class="title">'+f.station_title+'</div><div class="url">'+f.station_url+"</div></div>"}c.html(d),$(".searchContainer").css({display:"inline-block"})})}),$(".searchContainer .close").on("click",function(a){$(this).parent().slideUp(500)}),$(".searchContainer").on("scroll",function(a){setTimeout(function(){$(".searchContainer").find(".close").animate({top:$(".searchContainer").scrollTop()+10+"px"},100)},50)}),$(".searchContainer").on("click",".add",function(a){g($(this).parent().data("stationId"),"Default")}),$(".searchContainer").on("dblclick",".station",function(a){g($(this).data("stationId"),"Default")}),$(".sortable").sortable({scroll:!0})}),$(window).load(function(){(new Date).getTime()});