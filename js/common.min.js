var dateStart=(new Date).getTime();$(document).ready(function(){function a(a){$("#player .info").html(a.data("stationTitle"))}function b(){var a=("0"+parseInt(j.currentTime%60)).slice(-2),b=("0"+parseInt(j.currentTime/60%60)).slice(-2);$("#player .time .hours").html(),$("#player .time .minutes").html(b),$("#player .time .seconds").html(a)}function c(a){$.ajax({data:{action:"getStation",id:a},success:function(a){for(var b=JSON.parse(a),c=h.find('.playlist[data-name="'+k.currentPlaylist+'"]'),d="",e=0;e<b.length;e++){var f=b[e];d+='<div class="track" data-station-id="'+f.station_id+'" data-station-title="'+f.station_title+'" data-station-url="'+f.station_url+'"><div class="delete"><i class="fa fa-minus"></i></div><div class="title">'+f.station_title+'</div><div class="url">'+f.station_url+"</div></div>",k.playlists[k.currentPlaylist].tracks.push(+f.station_id),k.playlists[k.currentPlaylist].currentTrack={id:f.station_id,url:f.station_url,title:f.station_title}}localStorage.setItem("playerState",JSON.stringify(k)),c.html(c.html()+d),c.find(".track").removeClass("selected"),c.find(".track:last").addClass("selected")}})}function d(a){this.name=a,this.tracks=[],this.currentTrack={},this.htmlEl='<div class="playlist active sortable" data-name="'+this.name+'">',k.playlists[a]=this,k.playlistsOrder.push(this.name)}function e(a){console.log(a),clearInterval(n),a.parent().children(".track:not(.selected)").removeClass("visualisation"),a.addClass("visualisation"),$("#player .play").addClass("visualisation"),$("#player .play span").remove(),$("#player .play.visualisation").prepend('<span class="inner"></span><span class="outer"></span>');var b=Math.floor(360*Math.random()),c=b+180,d=Math.floor(360*Math.random());n=setInterval(function(){a.css({backgroundImage:"linear-gradient(to right, hsl("+ ++b%360+", 60%, 50%) 0%, hsl("+ ++c%360+", 60%, 50%) 100%)"}),$("#player .play.visualisation").css({boxShadow:"0px 0px 5px 0.4px hsl("+ ++d%360+", 100%, 50%)",borderColor:"hsl("+ ++d%360+", 100%, 50%)"}),$("#player .play.visualisation .inner").css({borderBottomColor:"hsl("+ ++d%360+", 100%, 50%)"}),$("#player .play.visualisation .outer").css({borderTopColor:"hsl("+ ++d%360+", 100%, 50%)"})},50)}function f(a){clearInterval(n),a.removeClass("visualisation").css({backgroundImage:"none"}),$("#player .play").removeClass("visualisation").css({boxShadow:"none",borderColor:"#0ff"}),$("#player .play span").remove()}$.ajaxSetup({type:"POST",url:"actions.php",complete:function(){},statusCode:{200:function(a){},403:function(a){var b=JSON.parse(a.responseText);$("body").prepend(b.message)}},error:function(a,b,c,d){console.log("error")}});var g=$("body");g.attr("data-useragent",navigator.userAgent);var h=$("#player .playlistContainer"),i=$("#player .playlistsPanel"),j=new Audio,k={playlists:{},playlistsOrder:[],currentPlaylist:"",volume:j.volume,paused:j.paused};if(void 0==localStorage.getItem("playerState")){new d("Default");k.currentPlaylist="Default",i.append('<div class="plName" data-name="Default">Default</div>'),h.append(k.playlists[k.currentPlaylist].htmlEl),localStorage.setItem("playerState",JSON.stringify(k))}else{k=JSON.parse(localStorage.getItem("playerState"));for(var l=0;l<k.playlistsOrder.length;l++)i.append('<div class="plName" data-name="'+k.playlistsOrder[l]+'">'+k.playlistsOrder[l]+"</div>");j.volume=k.volume,j.src=k.playlists[k.currentPlaylist].currentTrack.url,j.paused=k.paused,h.append(k.playlists[k.currentPlaylist].htmlEl);var m=k.playlists[k.currentPlaylist].tracks;$.ajax({data:{action:"getTargetStations",id:m},success:function(a){for(var b=JSON.parse(a),c=h.find('.playlist[data-name="'+k.currentPlaylist+'"]'),d="",e=0;e<b.length;e++){var f=b[e];d+='<div class="track" data-station-id="'+f.station_id+'" data-station-title="'+f.station_title+'" data-station-url="'+f.station_url+'"><div class="delete"><i class="fa fa-minus"></i></div><div class="title">'+f.station_title+'</div><div class="url">'+f.station_url+"</div></div>"}c.html(c.html()+d),c.find(".track[data-station-id="+k.playlists[k.currentPlaylist].currentTrack.id+"]").addClass("selected")}}),k.paused||(j.play(),console.log($(".playlistContainer .active [data-station-id="+k.playlists[k.currentPlaylist].currentTrack.id+"]")),e($(".playlistContainer .active [data-station-id="+k.playlists[k.currentPlaylist].currentTrack.id+"]")))}console.log($(".playlistContainer .active .track[data-station-id="+k.playlists[k.currentPlaylist].currentTrack.id+"]"));var n=null;$("#player .play").on("mouseover",function(a){$(this).css({boxShadow:"0px 0px 5px 0.4px #0ff"})}),$("#player .play").on("mouseout",function(a){$(this).css({boxShadow:"none"})}),$("#player .play").click(function(c){if($(".playlist").children(".selected").length>0){var d=($(".playlistContainer .active .selected"),$(".playlistContainer .active [data-station-id="+k.playlists[k.currentPlaylist].currentTrack.id+"]"));console.log(d),j.src=$(".playlistContainer .selected").data("stationUrl"),k.playlists[k.currentPlaylist].currentTrack={id:$(".playlistContainer .selected").data("stationId"),url:j.src,title:$(".playlistContainer .selected").data("stationTitle")},j.play(),k.paused=j.paused,localStorage.setItem("playerState",JSON.stringify(k)),e($(".active [data-station-id="+k.playlists[k.currentPlaylist].currentTrack.id+"]")),a($(".playlist .selected")),b(),setInterval(function(){b()},1e3)}}),$("#player .stop").click(function(a){j.pause(),$("#player .play").removeClass("visualisation"),k.paused=j.paused;var b=$(".playlistContainer .active [data-station-id="+k.playlists[k.currentPlaylist].currentTrack.id+"]");f(b),localStorage.setItem("playerState",JSON.stringify(k)),j.currentTime=0,$("#player .info").html("")}),$(".playlistContainer").on("mousedown",".track",function(a){$(this).parent().find(".selected").removeClass("selected"),$(this).addClass("selected")}),$(".playlistContainer").on("dblclick",".track",function(c){var d=$(this).data("stationUrl");j.src=d,j.play(),k.playlists[k.currentPlaylist].currentTrack={id:$(".playlistContainer .selected").data("stationId"),url:j.src,title:$(".playlistContainer .selected").data("stationTitle")};var f=$(".playlistContainer .active [data-station-id="+k.playlists[k.currentPlaylist].currentTrack.id+"]");e(f),k.paused=j.paused,localStorage.setItem("playerState",JSON.stringify(k)),a($(this)),b(),setInterval(function(){b()},1e3)}),$("#player .volume input").val(100*j.volume),$("#player .volume .val").html(Math.floor(100*j.volume)),$("#player .volume input").on("input",function(a){j.volume=parseFloat($(this).val()/100),k.volume=j.volume,$("#player .volume .val").html($(this).val()),localStorage.setItem("playerState",JSON.stringify(k))}),$("#player .find .showFieldSearch").click(function(a){var b=$(this).parent().find("input");0==b.hasClass("visible")?(b.addClass("visible").animate({opacity:1,width:212},100),setTimeout(function(){b.focus()},300)):b.removeClass("visible").animate({opacity:0,width:0},100).blur()}),$("#player .find input").on("keyup",function(a){var b=$(this).val();b.length>2&&$.ajax({data:{action:"find",target:b},success:function(a){var b=JSON.parse(a),c=$(".searchContainer .result");c.html("");for(var d='<div class="total"><span>'+b.length+"</span> stations is found</div>",e=0;e<b.length;e++){var f=b[e];d+='<div class="station" data-station-id="'+f.station_id+'"><div class="add"><i class="fa fa-plus"></i></div><div class="title">'+f.station_title+'</div><div class="url">'+f.station_url+"</div></div>"}c.html(d),$(".searchContainer").css({display:"inline-block"})}})}),$(".searchContainer .close").on("click",function(a){$(this).parents(".searchContainer").slideUp(500)}),$(".searchContainer").on("scroll",function(a){setTimeout(function(){$(".searchContainer").find(".close").animate({top:$(".searchContainer").scrollTop()+10+"px"},100)},50)}),$(".searchContainer").on("click",".add",function(a){c($(this).parent().data("stationId"))}),$(".searchContainer").on("dblclick",".station",function(a){c($(this).data("stationId"))}),$(".sortable").sortable({scroll:!0}),i.append('<div class="plName" data-name="Default">Default</div>'),i.append('<div class="plName" data-name="Default">Default</div>')}),$(window).load(function(){(new Date).getTime();playerState=JSON.parse(localStorage.getItem("playerState")),console.log($(".playlistContainer .active [data-station-id="+playerState.playlists[playerState.currentPlaylist].currentTrack.id+"]"))});