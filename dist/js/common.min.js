var dateStart=(new Date).getTime();$(document).ready(function(){function a(a,b){return Math.floor(Math.random()*(b-a+1))+a}function b(){$("#player .info").html(l.playlists[l.currentPlaylist].currentTrack.title)}function c(){var a=("0"+parseInt(k.currentTime%60)).slice(-2),b=("0"+parseInt(k.currentTime/60%60)).slice(-2);$("#player .time .hours").html(),$("#player .time .minutes").html(b),$("#player .time .seconds").html(a)}function d(a){$.ajax({data:{action:"getStation",id:a},success:function(a){for(var b=JSON.parse(a),c=i.find('.playlist[data-name="'+l.currentPlaylist+'"]'),d="",e=0;e<b.length;e++){var f=b[e];d+='<div class="track" data-station-id="'+f.station_id+'" data-station-title="'+f.station_title+'" data-station-url="'+f.station_url+'"><div class="delete"><i class="fa fa-minus"></i></div><div class="title">'+f.station_title+'</div><div class="url">'+f.station_url+"</div></div>",l.playlists[l.currentPlaylist].tracks.push(+f.station_id),l.playlists[l.currentPlaylist].currentTrack={id:f.station_id,url:f.station_url,title:f.station_title}}localStorage.setItem("playerState",JSON.stringify(l)),c.html(c.html()+d),c.find(".track").removeClass("selected"),c.find(".track:last").addClass("selected")}})}function e(a){this.name=a,this.tracks=[],this.currentTrack={},this.htmlEl='<div class="playlist active sortable" data-name="'+this.name+'">',l.playlists[a]=this,l.playlistsOrder.push(this.name)}function f(a){console.log(a),clearInterval(o),a.parent().children(".track:not(.selected)").removeClass("visualisation").removeAttr("style"),a.addClass("visualisation"),$("#player .play").addClass("visualisation"),$("#player .play span").remove(),$("#player .play.visualisation").prepend('<span class="inner"></span><span class="outer"></span>');var b=Math.floor(360*Math.random()),c=b+180,d=Math.floor(360*Math.random());o=setInterval(function(){a.css({backgroundImage:"linear-gradient(to right, hsl("+ ++b%360+", 60%, 50%) 0%, hsl("+ ++c%360+", 60%, 50%) 100%)"}),$("#player .play.visualisation").css({boxShadow:"0px 0px 5px 0.4px hsl("+ ++d%360+", 100%, 50%)",borderColor:"hsl("+ ++d%360+", 100%, 50%)"}),$("#player .play.visualisation .inner").css({borderBottomColor:"hsl("+ ++d%360+", 100%, 50%)"}),$("#player .play.visualisation .outer").css({borderTopColor:"hsl("+ ++d%360+", 100%, 50%)"})},50)}function g(a){clearInterval(o),a.removeClass("visualisation").css({backgroundImage:"none"}).removeAttr("style"),$("#player .play").removeClass("visualisation").css({boxShadow:"none",borderColor:"#0ff"}).removeAttr("style"),$("#player .play span").remove()}$.ajaxSetup({type:"POST",url:"actions.php",complete:function(){},statusCode:{200:function(a){},403:function(a){var b=JSON.parse(a.responseText);$("body").prepend(b.message)}},error:function(a,b,c,d){console.log("error")}});var h=$("body");h.attr("data-useragent",navigator.userAgent);var i=$("#player .playlistContainer"),j=$("#player .playlistsPanel"),k=new Audio,l={playlists:{},playlistsOrder:[],currentPlaylist:"",volume:k.volume,paused:k.paused};if(void 0==localStorage.getItem("playerState")){new e("Default");l.currentPlaylist="Default",j.append('<div class="plName" data-name="Default">Default</div>'),i.append(l.playlists[l.currentPlaylist].htmlEl),localStorage.setItem("playerState",JSON.stringify(l))}else{l=JSON.parse(localStorage.getItem("playerState"));for(var m=0;m<l.playlistsOrder.length;m++)j.append('<div class="plName" data-name="'+l.playlistsOrder[m]+'">'+l.playlistsOrder[m]+"</div>");k.volume=l.volume,k.src=l.playlists[l.currentPlaylist].currentTrack.url,k.paused=l.paused,i.append(l.playlists[l.currentPlaylist].htmlEl);var n=l.playlists[l.currentPlaylist].tracks;$.ajax({data:{action:"getPlaylistStations",id:n},success:function(a){for(var d=JSON.parse(a),e=i.find('.playlist[data-name="'+l.currentPlaylist+'"]'),g="",h=0;h<d.length;h++){var j=d[h];g+='<div class="track" data-station-id="'+j.station_id+'" data-station-title="'+j.station_title+'" data-station-url="'+j.station_url+'"><div class="delete"><i class="fa fa-minus"></i></div><div class="title">'+j.station_title+'</div><div class="url">'+j.station_url+"</div></div>"}e.html(e.html()+g),e.find(".track[data-station-id="+l.playlists[l.currentPlaylist].currentTrack.id+"]").addClass("selected"),l.paused||(k.play(),b(),c(),setInterval(function(){c()},1e3),f($(".playlistContainer .active [data-station-id="+l.playlists[l.currentPlaylist].currentTrack.id+"]")))}})}var o=null;$("#player .play").click(function(a){if($(".playlist").children(".selected").length>0){l.playlists[l.currentPlaylist].currentTrack={id:$(".playlistContainer .selected").data("stationId"),url:k.src,title:$(".playlistContainer .selected").data("stationTitle")};var d=$(".playlistContainer .active [data-station-id="+l.playlists[l.currentPlaylist].currentTrack.id+"]");console.log(d),k.src=$(".playlistContainer .selected").data("stationUrl"),k.play(),l.paused=k.paused,f(d),b(),c(),localStorage.setItem("playerState",JSON.stringify(l)),setInterval(function(){c()},1e3)}}),$(".playlistContainer").on("dblclick",".track",function(a){var d=$(this).data("stationUrl");k.src=d,k.play(),l.playlists[l.currentPlaylist].currentTrack={id:$(".playlistContainer .selected").data("stationId"),url:k.src,title:$(".playlistContainer .selected").data("stationTitle")};var e=$(".playlistContainer .active [data-station-id="+l.playlists[l.currentPlaylist].currentTrack.id+"]");f(e),l.paused=k.paused,localStorage.setItem("playerState",JSON.stringify(l)),b(),c(),setInterval(function(){c()},1e3)}),$("#player .stop").click(function(a){k.pause(),$("#player .play").removeClass("visualisation"),l.paused=k.paused;var b=$(".playlistContainer .active [data-station-id="+l.playlists[l.currentPlaylist].currentTrack.id+"]");g(b),localStorage.setItem("playerState",JSON.stringify(l)),k.currentTime=0,$("#player .info").html("")}),$(".playlistContainer").on("click",".delete",function(a){var b=$(this).parent().data("stationId"),c=l.playlists[l.currentPlaylist];c.tracks.splice(c.tracks.indexOf(b),1),$(this).parent().remove(),console.log(l),localStorage.setItem("playerState",JSON.stringify(l))}),$(".playlistContainer").on("mousedown",".track",function(a){$(this).parent().find(".selected").removeClass("selected"),$(this).addClass("selected")}),$("#player .volume input").val(100*k.volume),$("#player .volume .val").html(Math.floor(100*k.volume)),$("#player .volume input").on("input",function(a){k.volume=parseFloat($(this).val()/100),l.volume=k.volume,$("#player .volume .val").html($(this).val()),localStorage.setItem("playerState",JSON.stringify(l))}),$("#player .find .showFieldSearch").click(function(a){var b=$(this).parent().find("input");0==b.hasClass("visible")?(b.addClass("visible").animate({opacity:1,width:212},100),setTimeout(function(){b.focus()},300)):b.removeClass("visible").animate({opacity:0,width:0},100).blur()}),$("#player .find input").on("keyup",function(a){var b=$(this).val();b.length>2&&$.ajax({data:{action:"search",target:b},success:function(a){var b=JSON.parse(a),c=$(".searchContainer .result");c.html("");for(var d='<div class="total"><span>'+b.length+"</span> stations is found</div>",e=0;e<b.length;e++){var f=b[e];d+='<div class="station" data-station-id="'+f.station_id+'"><div class="add"><i class="fa fa-plus"></i></div><div class="title">'+f.station_title+'</div><div class="url">'+f.station_url+"</div></div>"}c.html(d),$(".searchContainer").css({display:"inline-block"})}})}),$("#player .find .showAll").on("click",function(a){$.ajax({data:{action:"getAllStations"},success:function(a){var b=JSON.parse(a),c=$(".searchContainer .result");c.html("");for(var d='<div class="total"><span>'+b.length+"</span> stations is found</div>",e=0;e<b.length;e++){var f=b[e];d+='<div class="station" data-station-id="'+f.station_id+'"><div class="add"><i class="fa fa-plus"></i></div><div class="title">'+f.station_title+'</div><div class="url">'+f.station_url+"</div></div>"}c.html(d),$(".searchContainer").css({display:"inline-block"})}})}),$(".searchContainer .close").on("click",function(a){$(this).parents(".searchContainer").slideUp(500)}),$(".searchContainer").on("scroll",function(a){setTimeout(function(){$(".searchContainer").find(".close").animate({top:$(".searchContainer").scrollTop()+10+"px"},100)},50)}),$(".searchContainer").on("click",".add",function(a){d($(this).parent().data("stationId"))}),$(".searchContainer").on("dblclick",".station",function(a){d($(this).data("stationId"))}),$(".sortable").sortable({scroll:!0}),$("body").css({background:'url("../img/bg/bg'+a(1,10)+'.jpg") no-repeat center / cover'}),$(function(){for(var a=new Array(10),b=0;b<a.length;b++){var c="/img/bg/bg"+(b+1)+".jpg";a[b]=c}$.mbBgndGallery.buildGallery({containment:"body",timer:3e3,effTimer:11e3,shuffle:!0,effect:"fade",images:a,onChange:function(a){}})})}),$(window).load(function(){(new Date).getTime()});