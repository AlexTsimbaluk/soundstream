"use strict";function getParams(){for(var t={},e=window.location.search.substring(1).split("&"),a=0;a<e.length;a++){var o=e[a].split("=");t[o[0]]=void 0===o[1]?"":o[1]}return t}function d(t){$(".debug").html(t)}function getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function getRandomRgbColor(){return"rgb("+getRandomInt(0,255)+","+getRandomInt(0,255)+","+getRandomInt(0,255)+")"}function getHash(t){for(var e="",a=0;a<t;a++)e+=String.fromCharCode(getRandomInt(33,127));return e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dateStart=(new Date).getTime();$.ajaxSetup({type:"POST",url:"actions.php",complete:function(){},statusCode:{200:function(t){},403:function(t){var e=JSON.parse(t.responseText);$("body").prepend(e.message)}},error:function(t,e,a,o){console.log("XHR error")}}),void 0!==getParams().admin?$("body").addClass("admin"):$("body").removeClass("admin"),$(document).ready(function(){function t(){console.log("function::displayState");var t,e,a=h().title,o=a.length,n=$("#player .info .trackTitle"),l=250;$("title").html(a+"::RadioRA"),console.log(a),console.log(F.trackTitle),F.trackTitle=a,console.log(F.trackTitle),n.removeClass("runningString").parent().css({width:"auto"}),t=n.width(),e=t/o,Math.floor(l/e),console.log(t),console.log(n.text()),n.addClass("runningString").parent().css({width:"220px"})}function e(t){this.name=t,this.tracks=[],this.currentTrack={},this.titleHtmlEl='<div class="playlist sortable" data-name="'+this.name+'">'+this.name+"</div>",this.htmlEl='<div class="playlist sortable" data-name="'+this.name+'"></div>',I.currentPlaylist=this.name,I.playlistsOrder.push(this.name),E[t]=this,localStorage.setItem("playerState",JSON.stringify(I)),localStorage.setItem("__playlists",JSON.stringify(E))}function a(){var t=this;this.templateTrack=$(".template-track").html(),this.addPanel=function(t){b.find(".list .mCSB_container").append($(E[t].titleHtmlEl));var e=b.find(".playlist").length-1,a=E.playlistPanelWidth||b.find(".playlist:first").innerWidth(),o=a*e;b.find(".playlist:last").attr("data-scroll-left",o)},this.addTrackToPlaylist=function(e){var a=t.makeTrack([e]);k.hasClass("mCustomScrollbar")?k.find(".mCSB_container").append(a):k.append(a),E[I.currentPlaylist].tracks.push(+e),console.log(E),localStorage.setItem("__playlists",JSON.stringify(E))},this.makeTrack=function(t){for(var e=t,a=$(".template-track").html(),o=[],n=0;n<e.length;n++){var l=T[e[n]],s=$(a);s.attr("data-station-id",l.station_id),s.attr("data-station-title",l.station_title),s.attr("data-station-url",l.station_url),s.find(".title").text(l.station_title),s.find(".url").text(l.station_url),o.push(s)}return o},this.makePlaylistTracks=function(e){for(var a=(E[I.currentPlaylist],t.makeTrack(e)),o=0;o<a.length;o++){var n=a[o];k.hasClass("mCustomScrollbar")?k.find(".mCSB_container").append(n):k.append(n)}k.hasClass("mCustomScrollbar")||$(".playlistContainer").mCustomScrollbar({})},this.setCurrent=function(e,a){$(".playlistsPanel").find(".list").mCustomScrollbar("scrollTo",b.find("[data-current]").attr("data-scroll-left")),b.find('[data-name="'+I.currentPlaylist+'"]').removeAttr("data-current"),b.find('[data-name="'+e+'"]').attr("data-current",1),I.currentPlaylist=e,k.find(".mCSB_container").children().remove();var o=E[I.currentPlaylist].tracks;o.length&&t.makePlaylistTracks(o),E[I.currentPlaylist].scrollPosition=a,localStorage.setItem("playerState",JSON.stringify(I)),localStorage.setItem("__playlists",JSON.stringify(E))}}function o(t,e,a){var o=this,n=t.createAnalyser();n.smoothingTimeConstant=a.smoothingTimeConstant||.7,n.fftSize=a.fftSize||512,e.connect(n),n.connect(_.destination);var l=function(){n.getByteFrequencyData(o.streamData);for(var t=0,e=0;e<80;e++)t+=o.streamData[e]};setInterval(l,20),o.streamData=new Uint8Array(n.frequencyBinCount)}function n(t){var e=document.getElementById(t),a=this,n=_.createMediaElementSource(e),l=new o(_,n,{smoothingTimeConstant:.5,fftSize:1024}),i=new o(_,n,{smoothingTimeConstant:.5,fftSize:1024}),u=new o(_,n,{smoothingTimeConstant:.5,fftSize:64}),p=new o(_,n,{smoothingTimeConstant:.5,fftSize:512});this.streamData_1=l.streamData,this.streamData_2=i.streamData,this.streamData_3=u.streamData,this.streamData_4=p.streamData,s(e,"AudioApiElement"),this.playStream=function(t){console.log("AudioApiElement::playStream::Begin"),console.log(t);var o,n=$('[data-station-url="'+t+'"]');o=n.length?n.position().top:0,$(".playlistContainer").mCustomScrollbar("scrollTo",o),n.parent().find("[data-current-track]").removeAttr("data-current-track"),console.log(n),n.attr("data-current-track",1);var l={url:n.attr("data-station-url"),title:n.attr("data-station-title"),id:n.attr("data-station-id"),scrollPosition:o};E[v()].currentTrack=l,e.src=t,e.crossOrigin="anonymous",setTimeout(function(){e.crossOrigin="anonymous"},3e3);var s=e.play();void 0!==s&&s.then(function(){console.log("AudioApiElement::playPromise::Success::Begin"),console.log("AudioApiElement::playPromise::Success::End")}).catch(function(){console.log("AudioApiElement::playPromise::Failed::Begin"),a.stopStream(),L.playStream(t),console.log("Start audioCbElement"),console.log("AudioApiElement::playPromise::Failed::End")}),I.paused=e.paused,localStorage.setItem("playerState",JSON.stringify(I)),localStorage.setItem("__playlists",JSON.stringify(E)),(window.innerHeight>=720||window.innerWidth>=1e3)&&(r(),c()),d(),console.log("AudioApiElement::playStream::End")},this.stopStream=function(){g(),$("#player .play").removeClass("visualisation"),F.title="",$("#player .info .trackTitle").html("").removeClass("runningString").parent().css({width:"auto"}),e.pause(),L.stopStream(),console.log("AudioApiElement::stopStream"),localStorage.setItem("playerState",JSON.stringify(I))},this.setVolume=function(t){e.volume=t},this.getVolume=function(){return e.volume}}function l(){var t=new Audio;s(t,"AudioCbElement"),this.playStream=function(e){console.log("AudioCbElement::playStream::Begin"),t.src=e,t.play(),console.log(t.paused),I.paused=t.paused,localStorage.setItem("playerState",JSON.stringify(I)),console.log("AudioCbElement::playStream::End")},this.stopStream=function(){g(),$("#player .play").removeClass("visualisation"),$("#player .info .trackTitle").html("").removeClass("runningString").parent().css({width:"auto"}),t.pause(),t.currentTime=0,I.paused=t.paused,console.log("AudioCbElement::stopStream"),localStorage.setItem("playerState",JSON.stringify(I))},this.setVolume=function(e){t.volume=e},this.getVolume=function(){return t.volume}}function s(e,a){e.addEventListener("abort",function(t){console.log(a+"::Event.type::"+t.type),$(".spinner").hide()}),e.addEventListener("canplay",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("canplaythrough",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("durationchange",function(t){}),e.addEventListener("emptied",function(t){console.log(a+"::Event.type::"+t.type),$(".spinner").hide()}),e.addEventListener("encrypted",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("ended",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("error",function(t){console.log(a+"::Event.type::"+t.type),$(".spinner").hide(),I.paused?(console.log("paused"),$(".track.waiting").removeClass("waiting").addClass("error-playing")):console.log("это невозможно")}),e.addEventListener("interruptbegin",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("interruptend",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("loadeddata",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("loadedmetadata",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("loadstart",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("mozaudioavailable",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("pause",function(t){console.log(a+"::Event.type::"+t.type),console.log("pause::"+e.paused),e.currentTime=0,I.paused=e.paused,g()}),e.addEventListener("play",function(t){console.log(a+"::Event.type::"+t.type),$(".spinner").show(),$("[data-current-track]").addClass("waiting")}),e.addEventListener("playing",function(o){console.log(a+"::Event.type::"+o.type),console.log("pause::"+e.paused),I.paused=e.paused,$(".spinner").hide(),$("[data-current-track]").hasClass("waiting")&&$("[data-current-track]").removeClass("waiting"),$("[data-current-track]").hasClass("error-playing")&&$("[data-current-track]").removeClass("error-playing"),u(),t()}),e.addEventListener("ratechange",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("seeked",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("seeking",function(t){console.log(a+"::Event.type::"+t.type)}),e.addEventListener("timeupdate",function(t){var a=Math.ceil(e.currentTime),o=("0"+parseInt(Math.floor(a%60))).slice(-2),n=("0"+parseInt(Math.floor(a/60)%60)).slice(-2);$("#player .time .hours").html(),$("#player .time .minutes").html(n),$("#player .time .seconds").html(o)}),e.addEventListener("stalled",function(t){console.log(a+"::Event.type::"+t.type),$(".spinner").hide()}),e.addEventListener("suspend",function(t){}),e.addEventListener("waiting",function(t){console.log(a+"::Event.type::"+t.type)})}function i(t,e,a){var o=document.getElementById(t);o.width=e,o.height=a,this.ctx=o.getContext("2d"),this.canvasWidth=o.width,this.canvasHeight=o.height}function r(){var t=new i("canvas-audio-source",500,510);t.ctx.clearRect(0,0,t.canvasWidth,t.canvasHeight);for(var e=0;e<x.streamData_1.length;e++){var a=x.streamData_1[e];t.ctx.fillStyle="rgb("+a+","+a+","+a+")",t.ctx.fillRect(e,t.canvasHeight/2+1,1,Math.floor(-a/1.5)),t.ctx.fillRect(e,t.canvasHeight/2-1,1,Math.floor(a/1.5))}requestAnimationFrame(r)}function c(){var t=new i("canvas-audio-source-eq2",500,510);t.ctx.clearRect(0,0,t.canvasWidth,t.canvasHeight);for(var e=0,a=x.streamData_2.length;e<a;e++){var o=x.streamData_2[e];t.ctx.fillStyle="rgb("+(255-o)+","+o+","+(255-o)+")",t.ctx.fillRect(a-e,t.canvasHeight/2+1,1,-o/1.5),t.ctx.fillRect(a-e,t.canvasHeight/2-1,1,o/1.5)}requestAnimationFrame(c)}function d(){var t=new i("canvas-audio-source-eq3",288,20);t.ctx.clearRect(0,0,t.canvasWidth,t.canvasHeight);for(var e=Math.floor(25.5),a=Math.floor(t.canvasWidth/32),o=Math.floor(t.canvasHeight/e),n=3,l=a+n,s=o+n,r=0;r<x.streamData_3.length;r++)for(var c=x.streamData_3[r],u=Math.floor(c/10),g=0;g<u;g++)t.ctx.strokeStyle="rgb("+(255-c)+","+(255-c)+","+(255-c)+")",t.ctx.strokeRect(r*l,t.canvasHeight-g*s,a,o);requestAnimationFrame(d)}function u(){console.log("visualisation::Begin"),g();var t=$('.playlistContainer [data-station-id="'+h().id+'"]');t.addClass("visualisation"),$("#player .play").addClass("visualisation"),$("#player .play span").remove(),$("#player .play.visualisation").prepend('<span class="inner"></span><span class="outer"></span>');var e=Math.floor(360*Math.random()),a=e+180,o=Math.floor(360*Math.random());window.innerWidth>700&&(J=setInterval(function(){t.css({backgroundImage:"linear-gradient(to right, hsl("+ ++e%360+", 60%, 50%) 0%, hsl("+ ++a%360+", 60%, 50%) 100%)"}),$("#player .play.visualisation").css({boxShadow:"0px 0px 5px 0.4px hsl("+ ++o%360+", 100%, 50%)",borderColor:"hsl("+ ++o%360+", 100%, 50%)"}),$("#player .play.visualisation .inner").css({borderBottomColor:"hsl("+ ++o%360+", 100%, 50%)"}),$("#player .play.visualisation .outer").css({borderTopColor:"hsl("+ ++o%360+", 100%, 50%)"})},50)),console.log("visualisation::End")}function g(){console.log("visualisationStop::Begin"),clearInterval(J),$('.playlistContainer [data-station-id="'+h().id+'"]').removeClass("visualisation").css({backgroundImage:"none"}).removeAttr("style"),$("#player .play").removeClass("visualisation").css({boxShadow:"none",borderColor:"#0ff"}).removeAttr("style"),$("#player .play span").remove(),console.log("visualisationStop::End")}function p(){var t=Math.ceil(+$("#player .volume input").val()/10);q.clearRect(0,0,R,H);for(var e=36*t,a=0,o=3,n=1,l=Math.floor(R/(n+o)),s=Math.floor(l/10*t),i=H,r=i/l,c=0;c<s;c++)q.fillStyle="hsl("+c*e/s+", 100%, 50%)",q.fillRect(c*(n+o),H-c*r-r,o,c*r+r),q.fill();a+=15}function m(t){setTimeout(function(){$(".searchContainer .close").animate({top:-(t.mcs.top-10)+"px"},150)},50)}function v(){return I.currentPlaylist}function h(){return E[v()].currentTrack}function f(t){var e,a=h(),o=$('.playlistContainer [data-station-id="'+a.id+'"]');if("prev"===t)e=o.prev();else{if("next"!==t)throw new Error("Не передано направление!");e=o.next()}if(e.length)return e.attr("data-station-url");console.log("no siblings")}function y(){var t=$('[data-remove="prop"]'),e=t.find(".removeItem"),a=t.find(".removeItemList"),o=[],n="";e.attr("disabled","disabled"),e.attr("title","Change item of local storage"),o.push({prop:"search.stationsOpened",name:"StationsOpened"}),o.push({prop:"volume",name:"Volume"});for(var l=0;l<o.length;l++)n+='<li class="remove" data-change-prop="'+o[l].prop+'"><a href="#">'+o[l].name+"</a></li>";a.html(n),$("[data-change-prop]").on("click",function(t){var o=$(this).attr("data-change-prop");console.log(o),console.log(e),e.attr("data-remove-prop",o),e.removeAttr("disabled"),e.html(o).attr("title","playerState."+o),$("[data-remove-prop]").on("click",function(t){var e=$(this).attr("data-remove-prop"),o=a.find('[data-change-prop="'+e+'"]');switch(e){case"search.stationsOpened":delete I.search.stationsOpened,console.log("delete playerState."+e);break;case"volume":delete I.volume,console.log("delete playerState."+e)}return console.log(I),localStorage.setItem("playerState",JSON.stringify(I)),$(this).html("Reset").attr("disabled","disabled").attr("title","Change prop of playerState").removeAttr("data-remove-prop"),o.remove(),!1})})}function S(){var t=$('[data-remove="item"]'),e=t.find(".removeItem"),a=t.find(".removeItemList"),o=[],n="";e.attr("disabled","disabled"),e.attr("title","Change item of local storage"),o.push({item:"playerState",name:"playerState"}),o.push({item:"stations",name:"stations"}),o.push({item:"stationsOn100",name:"stationsOn100"}),o.push({item:"uniqHash",name:"uniqHash"}),o.push({item:"userStatus",name:"userStatus"}),o.push({item:"localStorage",name:"localStorage"});for(var l=0;l<o.length;l++)n+='<li class="remove" data-change-item="'+o[l].item+'"><a href="#">'+o[l].name+"</a></li>";a.html(n),$("[data-change-item]").on("click",function(t){var o=$(this),n=o.attr("data-change-item");console.log(o),e.attr("data-remove-item",n),e.removeAttr("disabled"),e.html(n).attr("title","Delete::"+n),$("[data-remove-item]").on("click",function(t){var e=$(this).attr("data-remove-item"),o=a.find('[data-change-item="'+e+'"]');if("stations"==o.attr("data-change-item")||"stationsOn100"==o.attr("data-change-item"))var n=[a.find('[data-change-item="stations"]'),a.find('[data-change-item="stationsOn100"]')];switch(console.log(o),e){case"playerState":localStorage.removeItem(e),console.log("delete "+e);break;case"stations":case"stationsOn100":localStorage.removeItem("stations"),localStorage.removeItem("stationsOn100"),console.log("delete "+e),console.log("delete "+e+"On100");break;case"uniqHash":case"userStatus":localStorage.removeItem(e),console.log("delete "+e);break;case"localStorage":localStorage.clear(),console.log("delete "+e),location.reload()}return $(this).html("Clear").attr("disabled","disabled").attr("title","Change item of local storage").removeAttr("data-remove-item"),n?(a.find('[data-change-item="stations"]').remove(),a.find('[data-change-item="stationsOn100"]').remove()):o.remove(),!1})})}if($("body").attr("data-useragent",navigator.userAgent),$("body").css({background:'url("../img/bg/bg'+getRandomInt(1,10)+'.jpg") no-repeat center / cover'}),$(function(){for(var t=new Array(10),e=0;e<t.length;e++){var a="/img/bg/bg"+(e+1)+".jpg";t[e]=a}$.mbBgndGallery.buildGallery({containment:"body",timer:3e3,effTimer:11e3,shuffle:!0,effect:"fade",images:t,onChange:function(t){}})}),$(".searchContainer").mCustomScrollbar({callbacks:{onScroll:function(){m(this)}}}),$("#player .prev").click(function(t){console.log("prev");var e=f("prev");console.log(e),e&&(x.stopStream(),x.playStream(e))}),$("#player .next").click(function(t){console.log("next");var e=f("next");console.log(e),e&&(x.stopStream(),x.playStream(e))}),$("#player .play").on("click",function(t){I.paused&&(x.playStream(h().url),$(".playlistContainer").mCustomScrollbar("scrollTo",h().scrollPosition))}),$(".playlistContainer").on("click",".track",function(t){if(I.paused){var e=$(this).data("stationUrl");x.playStream(e)}else if($(this).attr("data-current-track"))x.stopStream();else{var e=$(this).data("stationUrl");x.stopStream(),x.playStream(e)}console.log($(this).position().top)}),$("#player .stop").click(function(t){x.stopStream()}),$(".playlistContainer").on("click",".delete",function(t){var e=$(this).parent().data("stationId"),a=E[I.currentPlaylist];return a.tracks.splice(a.tracks.indexOf(e),1),$(this).parent().remove(),localStorage.setItem("__playlists",JSON.stringify(E)),!1}),$(".playlistContainer").on("click",".canplaytest",function(t){var e=$(t.target).closest(".track").data("stationUrl");console.log(e),t.stopPropagation()}),$(".toAdmin").on("click",function(t){return console.log("toAdmin"),$("body").addClass("admin"),$.ajax({data:{admin:1},success:function(t){$("#player").after(t),$("#player").hide(),$(".toPlayer").on("click",function(t){return console.log("toPlayer"),$(".admin-wrapper").remove(),$("body").removeClass("admin"),$("#player").fadeIn(300),!1})}}),!1}),$("#player .volume input").on("input",function(t){var e=$(this);x.setVolume(parseFloat($(this).val()/100)),L.setVolume(parseFloat($(this).val()/100)),I.volume=x.getVolume(),I.volume=L.getVolume(),$("#player .volume .val").html($(this).val()),0!=+e.val()?p(Math.ceil(+e.val()/10)):q.clearRect(0,0,R,H),localStorage.setItem("playerState",JSON.stringify(I))}),$("#player .volume").on("wheel",function(t){t=t||window.event;var e=$(this).find("input"),a=t.originalEvent.deltaY||t.originalEvent.detail||t.originalEvent.wheelDelta;return a>0&&+e.val()>0?e.val(+e.val()-2).trigger("input"):a<0&&+e.val()<100&&e.val(+e.val()+2).trigger("input"),!1}),$("#player .volume").on("click",function(t){return t=t||window.event,$(this).find("input").val(t.offsetX).trigger("input"),!1}),$("#player .find .showFieldSearch").click(function(t){$(this).toggleClass("active");var e=$(this).parent().find("input");0==e.hasClass("visible")?(e.addClass("visible").animate({opacity:1,width:190},100),setTimeout(function(){e.focus()},300)):e.removeClass("visible").animate({opacity:0,width:0},100).blur()}),$("#player .find input").on("keyup",function(t){var e=$(this).val();e.length>2&&($(".spinner").show(),$.ajax({data:{action:"search",target:e},success:function(t){var e=JSON.parse(t),a=$(".searchContainer .result"),o='<div class="total"><span>'+e.length+"</span> stations is found</div>";a.html("");for(var n=0;n<e.length;n++){var l=e[n];o+='<div class="station" data-station-id="'+l.station_id+'"><div class="add"><i class="fa fa-plus"></i></div><div class="title">'+l.station_title+'</div><div class="url">'+l.station_url+"</div></div>"}a.html(o),$(".spinner").hide(),$(".searchContainer").removeClass("searchContainerFadeOut").addClass("searchContainerFadeIn visible").parent().removeClass("playerLeft").addClass("playerRight"),window.innerHeight<=640&&window.innerWidth<700&&$(".playlistContainer").toggleClass("hidden")}}))}),$("#player .find .showAll").on("click",function(t){if($(this).toggleClass("active"),!$(".searchContainer .result .station").length){$(".spinner").show();var e=0;for(var a in T)e++;var o=I.search.stationsOpened||[],n=$(".searchContainer .result"),l=100,s=Math.ceil(e/l),i='<div class="total"><span>'+e+"</span> stations is found</div>";n.html("");for(var r=0;r<s;r++){var c=100*r,d=100*(r+1);r==s-1&&(d=(s-1).toString()+e%100),i+='<div class="stationsBlockToggle" data-show="closed" data-block-number="'+r+'"><div class="title">'+c+".."+d+"</div></div>"}if(n.html(i),$("[data-block-number]").on("click",function(t){var e="",a=$(this).attr("data-block-number");if("closed"==$(this).attr("data-show")){var n=A[a];e+='<div class="stationsBlockList" data-stations-number='+a+">";for(var l=0;l<n.length;l++){var s=n[l];e+='<div class="station" data-station-id="'+s.station_id+'"><div class="title">'+s.station_title+'</div><div class="url">'+s.station_url+"</div></div>"}e+="</div>",$(this).after(e),$(this).attr("data-show","open"),console.log(o),o.push(a),console.log(o),o.length>3&&(console.log("лишний "+o[0]),$('[data-stations-number="'+o[0]+'"]').remove(),$('[data-block-number="'+o[0]+'"]').attr("data-show","closed"),console.log(o),o.shift(),console.log(o)),console.log("stationsBlockToggle №"+a+" opened")}else{var i=o.filter(function(t){return console.log("filter"),t!=a});o=i,console.log(o),$(this).next("[data-stations-number]").remove(),$(this).attr("data-show","closed"),console.log("stationsBlockToggle №"+a+" removed")}return I.search.stationsOpened=o,console.log(o),console.log(I.search),console.log(I.search.stationsOpened),localStorage.setItem("playerState",JSON.stringify(I)),!1}),o.length>0){var u=o[o.length-1],g=$('[data-block-number="'+u+'"]'),p="";o=[],console.log("targetBlock is "+u);var m=A[u];p+='<div class="stationsBlockList" data-stations-number='+u+">";for(var r=0;r<m.length;r++){var v=m[r];p+='<div class="station" data-station-id="'+v.station_id+'"><div class="add"><i class="fa fa-plus"></i></div><div class="title">'+v.station_title+'</div><div class="url">'+v.station_url+"</div></div>"}p+="</div>",g.attr("data-show","open").after(p),console.log(o),o.push(u),console.log("stationsBlockToggle №"+u+" opened"),console.log(o),localStorage.setItem("playerState",JSON.stringify(I))}$(".spinner").hide()}$(".spinner").show(),$(".searchContainer").hasClass("visible")?$(".searchContainer").removeClass("searchContainerFadeIn visible").addClass("searchContainerFadeOut").parent().removeClass("playerRight").addClass("playerLeft"):$(".searchContainer").removeClass("searchContainerFadeOut").addClass("searchContainerFadeIn visible").parent().removeClass("playerLeft").addClass("playerRight"),window.innerHeight<=640&&window.innerWidth<700&&$(".playlistContainer").toggleClass("hidden"),$(".spinner").hide()}),$(".searchContainer .close").on("click",function(t){$(".showAll").removeClass("active"),window.innerHeight<=640&&window.innerWidth<700&&$(".playlistContainer").toggleClass("hidden"),$(".searchContainer").removeClass("searchContainerFadeIn visible").addClass("searchContainerFadeOut").parent().removeClass("playerRight").addClass("playerLeft")}),$(".searchContainer").on("click",".station",function(t){P.addTrackToPlaylist($(this).data("stationId"))}),$(".playlist-new").on("click",function(t){console.log("::new playlist");var a=(new Date).getTime().toString().substr(6);new e(a);b.find("[data-current]").removeAttr("data-current"),b.find("[data-name="+a+"]").attr("data-current",1),I.currentPlaylist=a,console.log(b.find("[data-name="+a+"]")),localStorage.setItem("playerState",JSON.stringify(I)),localStorage.setItem("__playlists",JSON.stringify(E))}),$(".playlistsPanel").on("click",".vmTitle",function(){var t=$(this).closest(".playlist");t.attr("data-current")?console.log("Плейлист уже выбран"):console.log("::Change playlist::"+t.attr("data-name"))}),window.innerHeight<=640&&window.innerWidth<700){var C=$("#player").height()-($("#player .playlistsPanel").height()+$("#player .trackContainer").height());console.log(C),$(".searchContainer, .playlistContainer","#player").height(C)}var k=$("#player .playlistContainer"),b=$("#player .playlistsPanel"),w=new Audio,O={reg:!1,auth:!1},E={},P=new a,I={playlists:{},playlistsOrder:[],currentPlaylist:"",volume:.27,paused:w.paused,search:{stationsOpened:[]}},T={},A=[],_=new(window.AudioContext||window.webkitAudioContext),x=new n("playerTag"),L=new l,J=null,N=document.getElementById("canvas-volume"),q=N.getContext("2d"),R=N.width,H=N.height;if(N.width=100,N.height=30,void 0==localStorage.getItem("userStatus")?(console.log("userStatus == undefined"),localStorage.setItem("userStatus",JSON.stringify(O))):O=JSON.parse(localStorage.userStatus),void 0==localStorage.getItem("stations")&&(console.log("stations == undefined"),$.ajax({data:{action:"getAllStations"},success:function(t){T=JSON.parse(t);var e=0;for(var a in T)e++;var o=Math.ceil(e/100),n=[];for(var a in T)n.push(a);for(var l=0;l<o;l++){A[l]=[];for(var s=0;s<100;s++){var i=n[100*l+s];if(l==o-1&&s==e%100)break;A[l][s]=T[i]}}localStorage.setItem("stations",JSON.stringify(T)),localStorage.setItem("stationsOn100",JSON.stringify(A)),location.reload()}})),void 0==localStorage.getItem("playerState")){console.log("playerState == undefined");var B=new e("Default");B.tracks=[883,3207,884,3771,1330,1193,2403,7943,3210,2400,55,885,7942],B.currentTrack={id:2400,url:"http://stream.dubstep.fm:80/256mp3",title:"Dubstep.fm - 256k MP3",scrollPosition:406},E.Default=B,E.Default.scrollPosition=0,console.log(E.Default),console.log(I),I.volume=.27,I.paused=!0,I.search.stationsOpened=[],localStorage.setItem("playerState",JSON.stringify(I)),localStorage.setItem("__playlists",JSON.stringify(E))}else{I=JSON.parse(localStorage.getItem("playerState")),E=JSON.parse(localStorage.getItem("__playlists")),T=JSON.parse(localStorage.getItem("stations")),A=JSON.parse(localStorage.getItem("stationsOn100")),console.log(I),console.log(E),y(),S(),console.log($(".vmPlaylistsPanel").length);new Vue({el:".vmPlaylistsPanel",data:{playlistsOrder:I.playlistsOrder,totalPl:I.playlistsOrder.length,plWidth:84,curPl:I.currentPlaylist},computed:{currentPlaylist:function(t){return this.curPl},scrollLeft:function(){return this.plWidth*this.totalPl}},methods:{setCurrentPlaylist:function(t,e){console.log(I.playlistsOrder[t]),console.log(e),$(".playlistsPanel").find(".list").mCustomScrollbar("scrollTo",b.find('[data-name="'+e+'"]').attr("data-scroll-left")),b.find('[data-name="'+I.currentPlaylist+'"]').removeAttr("data-current"),b.find('[data-name="'+e+'"]').attr("data-current",1),I.currentPlaylist=e,k.find(".mCSB_container").children().remove();var a=E[I.currentPlaylist].tracks;a.length&&P.makePlaylistTracks(a),localStorage.setItem("playerState",JSON.stringify(I)),localStorage.setItem("__playlists",JSON.stringify(E))},deletePlaylist:function(t,e){console.log(this.playlistsOrder),console.log(I.playlistsOrder[t]),console.log(E),console.log(E[I.playlistsOrder[t]]),delete E[I.playlistsOrder[t]],this.playlistsOrder.splice(t,1),I.playlistsOrder=this.playlistsOrder,console.log(this.playlistsOrder),localStorage.setItem("playerState",JSON.stringify(I)),localStorage.setItem("__playlists",JSON.stringify(E))},editPlaylist:function(t){console.log(t)}}});console.log($(".vmPlaylistsPanel").length),$(".playlistsPanel .list").mCustomScrollbar({axis:"x",advanced:{autoExpandHorizontalScroll:!0}}),$(".playlistsPanel .list").find(".mCSB_container").addClass("flex left"),b.find('[data-name="'+I.currentPlaylist+'"]').attr("data-current",1),console.log(b.find("[data-current]").attr("data-scroll-left")),$(".playlistsPanel").find(".list").mCustomScrollbar("scrollTo",b.find("[data-current]").attr("data-scroll-left")),x.setVolume(I.volume||.27),L.setVolume(I.volume||.27),$("#player .volume input").val(100*x.getVolume()),$("#player .volume input").val(100*L.getVolume()),$("#player .volume .val").html(Math.floor(100*x.getVolume())),$("#player .volume .val").html(Math.floor(100*L.getVolume())),p(),k.append(E[I.currentPlaylist].htmlEl);var M=E[I.currentPlaylist].tracks,D=b.find(".playlist:first").innerWidth();E.playlistPanelWidth=D,M.length>0?(console.log("make tracks:begin"),P.makePlaylistTracks(M),console.log("make tracks:end")):console.log("Выбранный плейлист пуст");var F=new Vue({el:".currentTrackTitle",data:{trackTitle:""},computed:{title:{get:function(){return this.trackTitle},set:function(t){this.trackTitle=t}}}});if(!I.paused){var V=h().url;x.playStream(V)}}}),$(window).load(function(){}),$(document).ready(function(){function t(t){$.ajax({data:{action:"loginUniq",regLogin:t},success:function(t){if(t){$(".form-reg .regLogin").addClass("busy");var e=JSON.parse(t);$(".loginsUniq").html("");for(var a="",o=0;o<e.length;o++){a+='<div class="fieldUniq"><div class="field">'+e[o].user_login+"</div></div>"}$(".loginsUniq").html("Used :(:<br>"+a),setTimeout(function(){$(".loginsUniq").html("")},4e3)}else $(".form-reg .regLogin").hasClass("error")||($(".form-reg .regLogin").removeClass("busy"),$(".loginsUniq").html("Good choice!"),setTimeout(function(){$(".loginsUniq").html("")},4e3))}})}function e(t,e){t.fadeOut(e)}function a(t){var e;"text"==t.attr("type")?(e=/^[A-Za-zА-Яа-яЁё0-9\._-]{3,27}$/,"От 3 до 20 символов",t.position().top):"password"==t.attr("type")&&(e=/^[A-Za-zА-Яа-яЁё0-9\._-]{5,}$/,"От 5 символов",t.position().top);var a=t.val(),o=!0;return 0!=a.search(e)?(t.addClass("error"),o=!1):t.removeClass("error"),o}function o(t,e){return t.val()!=e.val()?(e.addClass("error"),!1):(e.removeClass("error"),!0)}$(".showFormSign").click(function(){$(this).toggleClass("active").siblings().toggleClass("active"),$(".form-auth").toggleClass("visible").fadeToggle(300),$(".overlayFull").toggleClass("visible").fadeToggle(300)}),$(".showFormReg").click(function(){$(this).toggleClass("active").siblings().toggleClass("active"),$(".form-reg").toggleClass("visible").fadeToggle(300),$(".overlayFull").toggleClass("visible").fadeToggle(300),$(".form-reg .regLogin").val().length>0&&t($(".form-reg .regLogin").val())}),$(".popup-overlay, .close-popup").click(function(t){e($(".popup-container, .popup-overlay"),500),$(":input",".popup-container").not(":button, :submit, :reset, :hidden").val("").removeAttr("checked").removeAttr("selected")}),$(".form-reg .regLogin").keyup(function(e){var o=$(".form-reg .regLogin");o.val().length>2&&t(o.val()),a($(this)),e.preventDefault()}),$(".form-reg .regPass").keyup(function(){a($(this))}),$(".form-reg .regPassEx").keyup(function(){o($(".form-reg .regPass"),$(this))}),$(".form-reg .regSubmit").click(function(t){var e=$(".form-reg .regLogin"),n=$(".form-reg .regPass"),l=$(".form-reg .regPassEx");return a(e)&&a(n)&&o(n,l)&&!e.hasClass("busy")&&$.ajax({data:{action:"regUser",regLogin:e.val(),regPass:n.val()},success:function(t){console.log("success"),$(".form-reg").fadeOut(300),$(".showFormReg").toggleClass("active").fadeToggle(300),$(".successReg").html("You have successfully signed up!").fadeIn(300).addClass("popupHide"),setTimeout(function(){$(".overlayFull").fadeOut(500)},4e3)}}),!1}),$(".form-auth .authSubmit").click(function(t){var e=$(".form-auth .authLogin"),o=$(".form-auth .authPass");return a(e)&&a(o)&&$.ajax({data:{action:"authUser",authLogin:e.val(),authPass:o.val()},success:function(t){if(t){console.log("data");var e=JSON.parse(t);console.log(e),$(".form-auth").fadeOut(300),$(".showFormSign").toggleClass("active").fadeToggle(300),$(".successAuth").html("Hi, "+e.user_login+"<br>Welcome to RA").fadeIn(300).addClass("popupHide"),setTimeout(function(){$(".overlayFull").fadeOut(500)},4e3)}else console.log("no data"),$(".errors").html("Login or password is not correct :("),setTimeout(function(){$(".errors").html("")},5e3)}}),!1})}),$(document).ready(function(){function t(t){$.ajax({data:{action:"checkUniqToday",cookie:t},success:function(o){o=JSON.parse(o),o.length>0?a(t):e(t)}})}function e(t){var e=navigator.userAgent,a=navigator.oscpu||navigator.platform,o=screen.width+"*"+screen.height,n=window.innerWidth+"*"+window.innerHeight;$.ajax({data:{action:"addVisit",cookie:t,useragent:e,platform:a,screensize:o,browsersize:n,timeonsite:1},success:function(t){}})}function a(t){$.ajax({data:{action:"addHit",cookie:t,timeonsite:1},success:function(t){}})}var o;void 0==localStorage.getItem("uniqHash")?(o=getHash(8),localStorage.setItem("uniqHash",o),e(o),console.log("+uniq visit first")):(o=localStorage.getItem("uniqHash"),t(o))}),$(document).ready(function(){function t(t){var e="Update SUCCES!"==t.result?"state-success":"state-warning";return'<div class="row"><div class="col-md-2">Запрос SQL</div>\t\t\t\t\t\t\t<div class="col-md-10">'+t.query+'</div></div>\t\t\t\t\t\t\t<br><br><div class="row '+e+'">\t\t\t\t\t\t\t<div class="col-md-2">Результат</div>\t\t\t\t\t\t\t<div class="col-md-10">'+t.result+"</div></div>"}$(".js-create-table").on("click",function(e){var a=$(this).attr("data-sql"),o=$($(this).attr("data-sql-value")+" option:selected").val();console.log(a),console.log(o),$.ajax({url:"actionsAdmin.php",data:{action:"makeSql",sqlAction:a,sqlValue:o},success:function(e){var a=JSON.parse(e);console.log(a);var o=$("#sqlResponse");modalBody=o.find(".modal-body"),responseMarkup=t(a),modalBody.html(responseMarkup),o.modal("toggle")}})}),$(".js-drop-table").on("click",function(e){var a=$(this).attr("data-sql"),o=$($(this).attr("data-sql-value")+" option:selected").val();console.log(a),console.log(o),$.ajax({url:"actionsAdmin.php",data:{action:"makeSql",sqlAction:a,sqlValue:o},success:function(e){var a=JSON.parse(e);console.log(a);var o=$("#sqlResponse");modalBody=o.find(".modal-body"),responseMarkup=t(a),modalBody.html(responseMarkup),o.modal("show")}})})});