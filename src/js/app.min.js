"use strict";function getParams(){for(var t={},e=window.location.search.substring(1).split("&"),a=0;a<e.length;a++){var n=e[a].split("=");t[n[0]]=void 0===n[1]?"":n[1]}return t}function d(t){$(".debug").html(t)}function getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function getRandomRgbColor(){return"rgb("+getRandomInt(0,255)+","+getRandomInt(0,255)+","+getRandomInt(0,255)+")"}function getHash(t){for(var e="",a=0;a<t;a++)e+=String.fromCharCode(getRandomInt(33,127));return e}var dateStart=(new Date).getTime();void 0!==getParams().admin?$("body").addClass("admin"):$("body").removeClass("admin"),$(".clearLocalStorage").on("click",function(t){return localStorage.clear(),!1}),$(".clearUniqHash").on("click",function(t){return localStorage.removeItem("uniqHash"),!1}),$(".toAdmin").on("click",function(t){return console.log("toAdmin"),$("body").addClass("admin"),$.ajax({data:{admin:1},success:function(t){$("#player").after(t),$("#player").hide(),$(".toPlayer").on("click",function(t){return console.log("toPlayer"),$(".admin-wrapper").remove(),$("body").removeClass("admin"),$("#player").fadeIn(300),!1})}}),!1}),$.ajaxSetup({type:"POST",url:"actions.php",complete:function(){},statusCode:{200:function(t){},403:function(t){var e=JSON.parse(t.responseText);$("body").prepend(e.message)}},error:function(t,e,a,n){console.log("XHR error")}}),$(document).ready(function(){function t(){var t,e,a,n=P.playlists[P.currentPlaylist].currentTrack.title,i=n.length,s=$("#player .info .trackTitle"),r=250;s.html(n).removeClass("runningString").parent().css({width:"auto"}),e=s.width(),a=e/i,t=Math.floor(r/a)-5,e>240?(console.log(e,i,a,t),console.log(n.length),window.innerWidth>700?s.addClass("runningString").parent().css({width:"240px"}):s.html(n.substr(0,t)+"...")):s.removeClass("runningString").parent().css({width:"auto"})}function e(){var t=("0"+parseInt(q.currentTime%60)).slice(-2),e=("0"+parseInt(q.currentTime/60%60)).slice(-2);$("#player .time .hours").html(),$("#player .time .minutes").html(e),$("#player .time .seconds").html(t)}function a(t){$.ajax({data:{action:"getStation",id:t},success:function(t){for(var e=JSON.parse(t),a=I.find('.playlist[data-name="'+P.currentPlaylist+'"]'),n="",i=0;i<e.length;i++){var s=e[i];n+='<div class="track" data-station-id="'+s.station_id+'" data-station-title="'+s.station_title+'" data-station-url="'+s.station_url+'"><div class="delete"><i class="fa fa-minus"></i></div><div class="title">'+s.station_title+'</div><div class="url">'+s.station_url+"</div></div>",P.playlists[P.currentPlaylist].tracks.push(+s.station_id),P.playlists[P.currentPlaylist].currentTrack={id:s.station_id,url:s.station_url,title:s.station_title}}localStorage.setItem("playerState",JSON.stringify(P)),a.html(a.html()+n),a.find(".track").removeClass("selected"),a.find(".track:last").addClass("selected")}})}function n(t){this.name=t,this.tracks=[],this.currentTrack={},this.htmlEl='<div class="playlist active sortable" data-name="'+this.name+'">',P.playlists[t]=this,P.playlistsOrder.push(this.name)}function i(e){function a(t){var e=p.createAnalyser();return e.smoothingTimeConstant=t.smoothingTimeConstant||.7,e.fftSize=t.fftSize||512,e}var n=document.getElementById(e),i=this,d=a({smoothingTimeConstant:.7,fftSize:256}),u=a({smoothingTimeConstant:.7,fftSize:1024}),m=a({smoothingTimeConstant:.7,fftSize:64}),g=p.createMediaElementSource(n);g.connect(d),g.connect(u),g.connect(m),d.connect(p.destination),u.connect(p.destination),m.connect(p.destination);var v=function(){d.getByteFrequencyData(i.streamData_1),u.getByteFrequencyData(i.streamData_2),m.getByteFrequencyData(i.streamData_3);for(var t=0,e=0;e<80;e++)t+=i.streamData_3[e]};setInterval(v,20),this.streamData_1=new Uint8Array(d.frequencyBinCount),this.streamData_2=new Uint8Array(u.frequencyBinCount),this.streamData_3=new Uint8Array(m.frequencyBinCount),this.playStream=function(e){P.playlists[P.currentPlaylist].currentTrack={id:$(".playlistContainer .selected").data("stationId"),url:e,title:$(".playlistContainer .selected").data("stationTitle")};var a=$(".playlistContainer .active [data-station-id="+P.playlists[P.currentPlaylist].currentTrack.id+"]");n.src=e,n.crossOrigin="anonymous",setTimeout(function(){n.crossOrigin="anonymous"},3e3),n.addEventListener("canplay",function(t){}),n.addEventListener("error",function(t){});var c=n.play();$(".spinner").show(),void 0!==c&&c.then(function(){console.log("Promise::Automatic playback started!"),$(".spinner").hide()}).catch(function(t){$(".spinner").hide(),i.stopStream(),console.log("Promise::Automatic playback failed..."),console.log(t)}),P.paused=n.paused,o(a),t(),i.updateTime(),localStorage.setItem("playerState",JSON.stringify(P)),setInterval(function(){i.updateTime()},1e3),console.log("AudioApiElement::playStream"),s(),r(),l()},this.stopStream=function(){c($(".playlistContainer .active [data-station-id="+P.playlists[P.currentPlaylist].currentTrack.id+"]")),$("#player .play").removeClass("visualisation"),$("#player .info .trackTitle").html("").removeClass("runningString").parent().css({width:"auto"}),n.pause(),n.currentTime=0,P.paused=n.paused,console.log("AudioApiElement::stopStream"),localStorage.setItem("playerState",JSON.stringify(P))},this.setVolume=function(t){n.volume=t},this.getVolume=function(){return n.volume},this.updateTime=function(){console.log("updateTime");var t=("0"+parseInt(n.currentTime%60)).slice(-2),e=("0"+parseInt(n.currentTime/60%60)).slice(-2);$("#player .time .hours").html(),$("#player .time .minutes").html(e),$("#player .time .seconds").html(t)},n.volume=P.volume}function s(){for(g.clearRect(0,0,v,h),bin=0;bin<_.streamData_1.length;bin++){var t=_.streamData_1[bin];g.fillStyle="rgb("+t+","+t+","+t+")",g.fillRect(bin,h,1,Math.floor(-t/1.5))}requestAnimationFrame(s)}function r(){for(y.clearRect(0,0,C,S),bin=0;bin<_.streamData_2.length;bin++){var t=_.streamData_2[bin];y.fillStyle="rgb("+(255-t)+","+t+","+(255-t)+")",y.fillRect(bin,S,1,-t/1)}requestAnimationFrame(r)}function l(){b.clearRect(0,0,k,T);for(var t=Math.floor(25.5),e=10,a=Math.floor(T/t),n=2,i=e+n,s=a+n,r=0;r<_.streamData_3.length;r++)for(var o=_.streamData_3[r],c=Math.floor(o/10),d=0;d<c;d++)b.strokeStyle="hsl("+(180-7*d)+", 100%, 50%)",b.strokeRect(r*i,T-d*s,e,a);requestAnimationFrame(l)}function o(t){clearInterval(F),t.parent().children(".track:not(.selected)").removeClass("visualisation").removeAttr("style"),t.addClass("visualisation"),$("#player .play").addClass("visualisation"),$("#player .play span").remove(),$("#player .play.visualisation").prepend('<span class="inner"></span><span class="outer"></span>');var e=Math.floor(360*Math.random()),a=e+180,n=Math.floor(360*Math.random());window.innerWidth>700&&(F=setInterval(function(){t.css({backgroundImage:"linear-gradient(to right, hsl("+ ++e%360+", 60%, 50%) 0%, hsl("+ ++a%360+", 60%, 50%) 100%)"}),$("#player .play.visualisation").css({boxShadow:"0px 0px 5px 0.4px hsl("+ ++n%360+", 100%, 50%)",borderColor:"hsl("+ ++n%360+", 100%, 50%)"}),$("#player .play.visualisation .inner").css({borderBottomColor:"hsl("+ ++n%360+", 100%, 50%)"}),$("#player .play.visualisation .outer").css({borderTopColor:"hsl("+ ++n%360+", 100%, 50%)"})},50))}function c(t){clearInterval(F),t.removeClass("visualisation").css({backgroundImage:"none"}).removeAttr("style"),$("#player .play").removeClass("visualisation").css({boxShadow:"none",borderColor:"#0ff"}).removeAttr("style"),$("#player .play span").remove()}function d(){var t=Math.ceil(+$("#player .volume input").val()/10);L.clearRect(0,0,M,N);for(var e=36*t,a=0,n=3,i=1,s=Math.floor(M/(i+n)),r=Math.floor(s/10*t),l=N,o=l/s,c=0;c<r;c++)L.fillStyle="hsl("+c*e/r+", 100%, 50%)",L.fillRect(c*(i+n),N-c*o-o,n,c*o+o),L.fill();a+=15}function u(t){setTimeout(function(){$(".searchContainer .close").animate({top:-(t.mcs.top-10)+"px"},150)},50)}var p=new(window.AudioContext||window.webkitAudioContext);$("body").attr("data-useragent",navigator.userAgent);var m=document.getElementById("canvas-audio-source"),g=m.getContext("2d");m.width=500,m.height=255;var v=m.width,h=m.height,f=document.getElementById("canvas-audio-source-eq2"),y=f.getContext("2d");f.width=500,f.height=255;var C=f.width,S=f.height,w=document.getElementById("canvas-audio-source-eq3"),b=w.getContext("2d");w.width=500,w.height=150;var k=w.width,T=w.height,I=$("#player .playlistContainer"),A=$("#player .playlistsPanel"),q=new Audio,O={reg:!1,auth:!1},P={playlists:{},playlistsOrder:[],currentPlaylist:"",volume:q.volume,paused:q.paused};if(void 0==localStorage.getItem("userStatus")?localStorage.setItem("userStatus",JSON.stringify(O)):O=JSON.parse(localStorage.userStatus),void 0==localStorage.getItem("playerState")){new n("Default");P.currentPlaylist="Default",A.append('<div class="plName" data-name="Default">Default</div>'),I.append(P.playlists[P.currentPlaylist].htmlEl),localStorage.setItem("playerState",JSON.stringify(P))}else{var _=new i("playerTag");P=JSON.parse(localStorage.getItem("playerState"));for(var x=0;x<P.playlistsOrder.length;x++)A.append('<div class="plName" data-name="'+P.playlistsOrder[x]+'">'+P.playlistsOrder[x]+"</div>");q.src=P.playlists[P.currentPlaylist].currentTrack.url,q.paused=P.paused,_.setVolume(P.volume),I.append(P.playlists[P.currentPlaylist].htmlEl);var R=P.playlists[P.currentPlaylist].tracks;$.ajax({data:{action:"getPlaylistStations",id:R},success:function(a){for(var n=JSON.parse(a),i=I.find('.playlist[data-name="'+P.currentPlaylist+'"]'),s="",r=($(".template-track").html(),0);r<n.length;r++){var l=n[r];s+='<div class="track" data-station-id="'+l.station_id+'" data-station-title="'+l.station_title+'" data-station-url="'+l.station_url+'"><div class="delete"><i class="fa fa-minus"></i></div><div class="title">'+l.station_title+'</div><div class="url">'+l.station_url+"</div></div>"}i.html(i.html()+s),i.find(".track[data-station-id="+P.playlists[P.currentPlaylist].currentTrack.id+"]").addClass("selected"),P.paused||(_.playStream(P.playlists[P.currentPlaylist].currentTrack.url),t(),e(),setInterval(function(){e()},1e3),o($(".playlistContainer .active [data-station-id="+P.playlists[P.currentPlaylist].currentTrack.id+"]")))}})}var F=null;$("#player .play").click(function(t){q.paused&&_.playStream(P.playlists[P.currentPlaylist].currentTrack.url)}),$(".playlistContainer").on("click",".track",function(t){if(q.paused)if($(this).attr("data-current-track"))$(this).removeAttr("data-current-track"),_.stopStream();else{$(this).attr("data-current-track",1);var e=$(this).data("stationUrl");_.playStream(e)}}),$("#player .stop").click(function(t){_.stopStream()}),$(".playlistContainer").on("click",".delete",function(t){var e=$(this).parent().data("stationId"),a=P.playlists[P.currentPlaylist];a.tracks.splice(a.tracks.indexOf(e),1),$(this).parent().remove(),localStorage.setItem("playerState",JSON.stringify(P))}),$(".playlistContainer").on("mousedown",".track",function(t){$(this).parent().find(".selected").removeClass("selected"),$(this).addClass("selected")});var D=document.getElementById("canvas-volume"),L=D.getContext("2d");D.width=100,D.height=30;var M=D.width,N=D.height;if($("#player .volume input").val(100*_.getVolume()),$("#player .volume .val").html(Math.floor(100*_.getVolume())),d(),$("#player .volume input").on("input",function(t){var e=$(this);_.setVolume(parseFloat($(this).val()/100)),P.volume=_.getVolume(),$("#player .volume .val").html($(this).val()),0!=+e.val()?d(Math.ceil(+e.val()/10)):L.clearRect(0,0,M,N),localStorage.setItem("playerState",JSON.stringify(P))}),$("#player .volume").on("wheel",function(t){t=t||window.event;var e=$(this).find("input"),a=t.originalEvent.deltaY||t.originalEvent.detail||t.originalEvent.wheelDelta;return a>0&&+e.val()>0?e.val(+e.val()-2).trigger("input"):a<0&&+e.val()<100&&e.val(+e.val()+2).trigger("input"),!1}),$("#player .volume").on("click",function(t){return t=t||window.event,$(this).find("input").val(t.offsetX).trigger("input"),!1}),$("#player .find .showFieldSearch").click(function(t){$(this).toggleClass("active");var e=$(this).parent().find("input");0==e.hasClass("visible")?(e.addClass("visible").animate({opacity:1,width:190},100),setTimeout(function(){e.focus()},300)):e.removeClass("visible").animate({opacity:0,width:0},100).blur()}),$("#player .find input").on("keyup",function(t){var e=$(this).val();e.length>2&&($(".spinner").show(),$.ajax({data:{action:"search",target:e},success:function(t){var e=JSON.parse(t),a=$(".searchContainer .result"),n='<div class="total"><span>'+e.length+"</span> stations is found</div>";a.html("");for(var i=0;i<e.length;i++){var s=e[i];n+='<div class="station" data-station-id="'+s.station_id+'"><div class="add"><i class="fa fa-plus"></i></div><div class="title">'+s.station_title+'</div><div class="url">'+s.station_url+"</div></div>"}a.html(n),$(".spinner").hide(),$(".searchContainer").removeClass("searchContainerFadeOut").addClass("searchContainerFadeIn visible").parent().removeClass("playerLeft").addClass("playerRight"),window.innerHeight<=640&&window.innerWidth<700&&$(".playlistContainer").toggleClass("hidden")}}))}),$("#player .find .showAll").on("click",function(t){$(this).toggleClass("active"),$(".spinner").show(),$.ajax({data:{action:"getAllStations"},success:function(t){var e=JSON.parse(t);result=$(".searchContainer .result"),markup='<div class="total"><span>'+e.length+"</span> stations is found</div>",result.html("");for(var a=0;a<e.length;a++){var n=e[a];markup+='<div class="station" data-station-id="'+n.station_id+'"><div class="add"><i class="fa fa-plus"></i></div><div class="title">'+n.station_title+'</div><div class="url">'+n.station_url+"</div></div>"}result.html(markup),$(".spinner").hide(),$(".searchContainer").hasClass("visible")?$(".searchContainer").removeClass("searchContainerFadeIn visible").addClass("searchContainerFadeOut").parent().removeClass("playerRight").addClass("playerLeft"):$(".searchContainer").removeClass("searchContainerFadeOut").addClass("searchContainerFadeIn visible").parent().removeClass("playerLeft").addClass("playerRight"),window.innerHeight<=640&&window.innerWidth<700&&$(".playlistContainer").toggleClass("hidden")}})}),$(".searchContainer .close").on("click",function(t){$(".showAll").removeClass("active"),window.innerHeight<=640&&window.innerWidth<700&&$(".playlistContainer").toggleClass("hidden"),$(".searchContainer").removeClass("searchContainerFadeIn visible").addClass("searchContainerFadeOut").parent().removeClass("playerRight").addClass("playerLeft")}),$(".searchContainer").on("click",".add",function(t){a($(this).parent().data("stationId"))}),$(".searchContainer").on("click",".station",function(t){a($(this).data("stationId"))}),$(".sortable").sortable({scroll:!0}),$(".searchContainer").mCustomScrollbar({callbacks:{onScroll:function(){u(this)}}}),$("body").css({background:'url("../img/bg/bg'+getRandomInt(1,10)+'.jpg") no-repeat center / cover'}),$(function(){for(var t=new Array(10),e=0;e<t.length;e++){var a="/img/bg/bg"+(e+1)+".jpg";t[e]=a}$.mbBgndGallery.buildGallery({containment:"body",timer:3e3,effTimer:11e3,shuffle:!0,effect:"fade",images:t,onChange:function(t){}})}),window.innerHeight<=640&&window.innerWidth<700){var E=$("#player").height()-($("#player .playlistsPanel").height()+$("#player .trackContainer").height());console.log(E),$(".searchContainer, .playlistContainer","#player").height(E)}}),$(window).load(function(){}),$(document).ready(function(){function t(t){$.ajax({data:{action:"loginUniq",regLogin:t},success:function(t){if(t){$(".form-reg .regLogin").addClass("busy");var e=JSON.parse(t);$(".loginsUniq").html("");for(var a="",n=0;n<e.length;n++){a+='<div class="fieldUniq"><div class="field">'+e[n].user_login+"</div></div>"}$(".loginsUniq").html("Used :(:<br>"+a),setTimeout(function(){$(".loginsUniq").html("")},4e3)}else $(".form-reg .regLogin").hasClass("error")||($(".form-reg .regLogin").removeClass("busy"),$(".loginsUniq").html("Good choice!"),setTimeout(function(){$(".loginsUniq").html("")},4e3))}})}function e(t,e){t.fadeOut(e)}function a(t){var e;"text"==t.attr("type")?(e=/^[A-Za-zА-Яа-яЁё0-9\._-]{3,27}$/,"От 3 до 20 символов",t.position().top):"password"==t.attr("type")&&(e=/^[A-Za-zА-Яа-яЁё0-9\._-]{5,}$/,"От 5 символов",t.position().top);var a=t.val(),n=!0;return 0!=a.search(e)?(t.addClass("error"),n=!1):t.removeClass("error"),n}function n(t,e){return t.val()!=e.val()?(e.addClass("error"),!1):(e.removeClass("error"),!0)}$(".showFormSign").click(function(){$(this).toggleClass("active").siblings().toggleClass("active"),$(".form-auth").toggleClass("visible").fadeToggle(300),$(".overlayFull").toggleClass("visible").fadeToggle(300)}),$(".showFormReg").click(function(){$(this).toggleClass("active").siblings().toggleClass("active"),$(".form-reg").toggleClass("visible").fadeToggle(300),$(".overlayFull").toggleClass("visible").fadeToggle(300),$(".form-reg .regLogin").val().length>0&&t($(".form-reg .regLogin").val())}),$(".popup-overlay, .close-popup").click(function(t){e($(".popup-container, .popup-overlay"),500),$(":input",".popup-container").not(":button, :submit, :reset, :hidden").val("").removeAttr("checked").removeAttr("selected")}),$(".form-reg .regLogin").keyup(function(e){var n=$(".form-reg .regLogin");n.val().length>2&&t(n.val()),a($(this)),e.preventDefault()}),$(".form-reg .regPass").keyup(function(){a($(this))}),$(".form-reg .regPassEx").keyup(function(){n($(".form-reg .regPass"),$(this))}),$(".form-reg .regSubmit").click(function(t){var e=$(".form-reg .regLogin"),i=$(".form-reg .regPass"),s=$(".form-reg .regPassEx");return a(e)&&a(i)&&n(i,s)&&!e.hasClass("busy")&&$.ajax({data:{action:"regUser",regLogin:e.val(),regPass:i.val()},success:function(t){console.log("success"),$(".form-reg").fadeOut(300),$(".showFormReg").toggleClass("active").fadeToggle(300),$(".successReg").html("You have successfully signed up!").fadeIn(300).addClass("popupHide"),setTimeout(function(){$(".overlayFull").fadeOut(500)},4e3)}}),!1}),$(".form-auth .authSubmit").click(function(t){var e=$(".form-auth .authLogin"),n=$(".form-auth .authPass");return a(e)&&a(n)&&$.ajax({data:{action:"authUser",authLogin:e.val(),authPass:n.val()},success:function(t){if(t){console.log("data");var e=JSON.parse(t);console.log(e),$(".form-auth").fadeOut(300),$(".showFormSign").toggleClass("active").fadeToggle(300),$(".successAuth").html("Hi, "+e.user_login+"<br>Welcome to RA").fadeIn(300).addClass("popupHide"),setTimeout(function(){$(".overlayFull").fadeOut(500)},4e3)}else console.log("no data"),$(".errors").html("Login or password is not correct :("),setTimeout(function(){$(".errors").html("")},5e3)}}),!1})}),$(document).ready(function(){function t(t){$.ajax({data:{action:"checkUniqToday",cookie:t},success:function(n){n=JSON.parse(n),n.length>0?a(t):e(t)}})}function e(t){var e=navigator.userAgent,a=navigator.oscpu||navigator.platform,n=screen.width+"*"+screen.height,i=window.innerWidth+"*"+window.innerHeight;$.ajax({data:{action:"addVisit",cookie:t,useragent:e,platform:a,screensize:n,browsersize:i,timeonsite:1},success:function(t){}})}function a(t){$.ajax({data:{action:"addHit",cookie:t,timeonsite:1},success:function(t){}})}var n;void 0==localStorage.getItem("uniqHash")?(n=getHash(8),localStorage.setItem("uniqHash",n),e(n),console.log("+uniq visit first")):(n=localStorage.getItem("uniqHash"),t(n))}),$(document).ready(function(){function t(t){var e="Update SUCCES!"==t.result?"state-success":"state-warning";return'<div class="row"><div class="col-md-2">Запрос SQL</div>\t\t\t\t\t\t\t<div class="col-md-10">'+t.query+'</div></div>\t\t\t\t\t\t\t<br><br><div class="row '+e+'">\t\t\t\t\t\t\t<div class="col-md-2">Результат</div>\t\t\t\t\t\t\t<div class="col-md-10">'+t.result+"</div></div>"}$(".js-create-table").on("click",function(e){var a=$(this).attr("data-sql"),n=$($(this).attr("data-sql-value")+" option:selected").val();console.log(a),console.log(n),$.ajax({url:"actionsAdmin.php",data:{action:"makeSql",sqlAction:a,sqlValue:n},success:function(e){var a=JSON.parse(e);console.log(a);var n=$("#sqlResponse");modalBody=n.find(".modal-body"),responseMarkup=t(a),modalBody.html(responseMarkup),n.modal("toggle")}})}),$(".js-drop-table").on("click",function(e){var a=$(this).attr("data-sql"),n=$($(this).attr("data-sql-value")+" option:selected").val();console.log(a),console.log(n),$.ajax({url:"actionsAdmin.php",data:{action:"makeSql",sqlAction:a,sqlValue:n},success:function(e){var a=JSON.parse(e);console.log(a);var n=$("#sqlResponse");modalBody=n.find(".modal-body"),responseMarkup=t(a),modalBody.html(responseMarkup),n.modal("show")}})})}),$(window).load(function(){});